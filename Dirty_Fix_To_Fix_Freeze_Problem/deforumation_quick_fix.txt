2023-05-21
-------------------------------------------
Ref: As noted from (https://github.com/vladmandic/automatic/issues/340).

One thing that could be the root to the freeze, is a race condition that could be created
between "../modules/processing.py:decode_first_stage" (used by the Live Previewer) and "../models/autoencoder:decode

It seems to have been more notible when using Torch 2.0+    .... Maybe because it is faster and there are more possibility
to create this race condition????

So anyone that experience freezing could try the following steps:

1. Use the modified "autoencoder.py" file in this folder to replacce: ..\stable-diffusion-webui\repositories\stable-diffusion-stability-ai\ldm\models\autoencoder.py
-- This adds a thread lock, to prevent the race condition.

2. Force an upgrade to the latest version of Gradio (as of speaking, 3.31.0)
Open a command line window and standing in the "..\stable-diffusion-webui\venv\Scripts\" folder, activate the python environment by running the "activate.bat" file from your command linme.
You should now have a new prompt with "(venv)" infron of it (meaning you have entered the environment).
From here run the command: pip install --upgrade gradio

That should be it. Kill the cmd window, and start: webui-user.bat or what ever you start-up file is.
